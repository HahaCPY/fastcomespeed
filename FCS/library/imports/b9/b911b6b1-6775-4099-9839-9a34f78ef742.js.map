{"version":3,"sources":["assets/Script/script/select/vehicleCtrl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport PositionManager from \"./PositionManager\";\n\n@ccclass\nexport default class CharacterController extends cc.Component {\n    @property\n    speed: number = 3;\n\n    private rb: cc.RigidBody3D = null;\n\n    onLoad() {\n        this.rb = this.getComponent(cc.RigidBody3D);\n\n        const fromMenu = cc.sys.localStorage.getItem(\"fromMenu\") === \"true\";\n\n        // if the character has a saved position, set it\n        const saved = fromMenu ? null : PositionManager.getSavedPosition();\n        if (saved) {\n            this.node.setPosition(saved);\n            PositionManager.clear();\n        }\n\n        // REMEMBER TO REMOVE THE FLAG\n        cc.sys.localStorage.removeItem(\"fromMenu\");\n\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    start() {\n        console.log(\"character's forward: \", this.node.forward);\n    }\n\n    onDestroy() {\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    private velocity = cc.v3();\n\n    private onKeyDown(event: cc.Event.EventKeyboard) {\n        if (event.keyCode === cc.macro.KEY.a) this.velocity.x = -this.speed;\n        if (event.keyCode === cc.macro.KEY.d) this.velocity.x = this.speed;\n        if (event.keyCode === cc.macro.KEY.w) this.velocity.z = -this.speed;\n        if (event.keyCode === cc.macro.KEY.s) this.velocity.z = this.speed;\n    }\n\n    private onKeyUp(event: cc.Event.EventKeyboard) {\n        if (event.keyCode === cc.macro.KEY.a || event.keyCode === cc.macro.KEY.d) this.velocity.x = 0;\n        if (event.keyCode === cc.macro.KEY.w || event.keyCode === cc.macro.KEY.s) this.velocity.z = 0;\n    }\n\n    update(dt: number) {\n        if (this.rb) {\n            this.rb.setLinearVelocity(this.velocity);\n\n            if (!this.velocity.equals(cc.Vec3.ZERO)) {\n                // dir = the direction that character should face\n                const dir = this.velocity.clone().normalize();\n\n                // targetQuat = the target rotation quaternion\n                // it can make the character face the direction of movement\n                const targetQuat = new cc.Quat();\n                cc.Quat.fromViewUp(targetQuat, dir, cc.Vec3.UP);\n\n                // make the rotation smooth\n                const currentQuat = new cc.Quat();\n                this.node.getRotation(currentQuat);\n                const smoothedQuat = new cc.Quat();\n                cc.Quat.slerp(smoothedQuat, currentQuat, targetQuat, dt * 10);\n\n                // set the smoothed rotation to the node\n                this.node.setRotation(smoothedQuat);\n            }\n        }\n        const vehicleNode = cc.find(\"vehicle/garbage-truck\");\n        if (vehicleNode) {\n            const vehiclePos = vehicleNode.getPosition();\n            if (vehiclePos.y < -2.5) {\n                vehicleNode.setPosition(-0.069, 0.15, 0.446);\n            }\n        }\n    }\n}"]}