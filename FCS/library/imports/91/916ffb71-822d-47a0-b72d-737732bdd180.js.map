{"version":3,"sources":["assets\\Script\\script\\select\\flagTrigger.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\nimport PositionManager from \"./PositionManager\";\r\n\r\n@ccclass\r\nexport default class FlagTrigger extends cc.Component {\r\n    @property(cc.Node)\r\n    vehicle: cc.Node = null;\r\n\r\n    @property(cc.Prefab)\r\n    hintPrefab: cc.Prefab = null;\r\n\r\n    // use Vec3 is better than Vec2 for 3D compatibility\r\n    @property(cc.Vec3)\r\n    hintOffset: cc.Vec3 = cc.v3(0.8, 0.1, 0);\r\n\r\n    @property\r\n    triggerDistance: number = 0.7;\r\n\r\n    @property\r\n    nowIn: number = 0;  // indicate the current stage number we step on\r\n\r\n    private hintInstance: cc.Node = null;\r\n    private hintScript: any = null;\r\n    private inRange: boolean = false;\r\n    private isLoadingScene: boolean = false;\r\n\r\n    onLoad() {\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\r\n        if (this.hintPrefab) {\r\n            this.hintInstance = cc.instantiate(this.hintPrefab);\r\n            this.node.addChild(this.hintInstance);\r\n\r\n            this.hintInstance.setPosition(this.hintOffset);\r\n\r\n            this.hintInstance.active = false;\r\n            this.hintInstance.scale = 0;\r\n\r\n            this.hintScript = this.hintInstance.getComponent(\"hintAnimation\");\r\n            this.hintScript.setKeyScale(this.nowIn);\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (!this.vehicle || !this.hintInstance || !this.hintScript) return;\r\n\r\n        const posA = this.node.getPosition();\r\n        const posB = this.vehicle.getPosition();\r\n        const dist = posA.subtract(posB).mag();\r\n\r\n        if (dist < this.triggerDistance) {\r\n            if (!this.inRange) {\r\n                this.hintInstance.active = true;\r\n                this.hintScript.playShow();\r\n                this.inRange = true;\r\n            }\r\n        } else {\r\n            if (this.inRange) {\r\n                this.hintScript.playHide();\r\n                this.inRange = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    onKeyDown(event: cc.Event.EventKeyboard) {\r\n        if (this.inRange && event.keyCode === cc.macro.KEY.e) {\r\n            cc.log(\"key E pressed\");\r\n\r\n            const worldPos = this.vehicle.convertToWorldSpaceAR(cc.Vec3.ZERO);\r\n            const localPos = this.node.parent.convertToNodeSpaceAR(worldPos);\r\n            PositionManager.savePosition(localPos.clone());\r\n\r\n            if (!this.isLoadingScene) {\r\n                this.isLoadingScene = true;\r\n\r\n                const maskNode = cc.find(\"MainCamera/mask3D\");\r\n                const maskScript = maskNode?.getComponent(\"maskTransition3D\");\r\n\r\n                if (!maskScript) {\r\n                    console.warn(\"⚠️ maskTransition script not found on mask3D node!\");\r\n                    return;\r\n                }\r\n                else {\r\n                    maskScript.playTransition(() => {\r\n                        switch (this.nowIn) {\r\n                            case 1:\r\n                                // need to add \"select/\" since it's what build settings use\r\n                                cc.director.loadScene(\"ice-cream-check\");\r\n                                break;\r\n                            case 2:\r\n                                cc.director.loadScene(\"pizza-check\");\r\n                                break;\r\n                            case 3:\r\n                                cc.director.loadScene(\"Menu\");\r\n                                break;\r\n                            default:\r\n                                cc.director.loadScene(\"selectScene\");\r\n                                break;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    getNowIn() {\r\n        return this.nowIn;\r\n    }\r\n}\r\n"]}