{"version":3,"sources":["assets/Script/script/select/flagTrigger.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAC5C,qDAAgD;AAGhD;IAAyC,+BAAY;IAArD;QAAA,qEA2GC;QAzGG,aAAO,GAAY,IAAI,CAAC;QAGxB,gBAAU,GAAc,IAAI,CAAC;QAE7B,oDAAoD;QAEpD,gBAAU,GAAY,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;QAGzC,qBAAe,GAAW,GAAG,CAAC;QAG9B,WAAK,GAAW,CAAC,CAAC,CAAE,+CAA+C;QAE3D,kBAAY,GAAY,IAAI,CAAC;QAC7B,gBAAU,GAAQ,IAAI,CAAC;QACvB,aAAO,GAAY,KAAK,CAAC;QACzB,oBAAc,GAAY,KAAK,CAAC;;IAuF5C,CAAC;IArFG,4BAAM,GAAN;QACI,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAE3E,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACpD,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAEtC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAE/C,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,KAAK,CAAC;YACjC,IAAI,CAAC,YAAY,CAAC,KAAK,GAAG,CAAC,CAAC;YAE5B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC;YAClE,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAC3C;IACL,CAAC;IAED,+BAAS,GAAT;QACI,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IAChF,CAAC;IAED,4BAAM,GAAN,UAAO,EAAU;QACb,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU;YAAE,OAAO;QAEpE,IAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;QACrC,IAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;QACxC,IAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,CAAC;QAEvC,IAAI,IAAI,GAAG,IAAI,CAAC,eAAe,EAAE;YAC7B,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;gBACf,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC;gBAChC,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;gBAC3B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;aACvB;SACJ;aAAM;YACH,IAAI,IAAI,CAAC,OAAO,EAAE;gBACd,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;gBAC3B,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;aACxB;SACJ;IACL,CAAC;IAED,+BAAS,GAAT,UAAU,KAA6B;QAAvC,iBAsCC;QArCG,IAAI,IAAI,CAAC,OAAO,IAAI,KAAK,CAAC,OAAO,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE;YAClD,EAAE,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YAExB,IAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,qBAAqB,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClE,IAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;YACjE,yBAAe,CAAC,YAAY,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC;YAE/C,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;gBACtB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;gBAE3B,IAAM,QAAQ,GAAG,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;gBAC9C,IAAM,UAAU,GAAG,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,YAAY,CAAC,kBAAkB,CAAC,CAAC;gBAE9D,IAAI,CAAC,UAAU,EAAE;oBACb,OAAO,CAAC,IAAI,CAAC,oDAAoD,CAAC,CAAC;oBACnE,OAAO;iBACV;qBACI;oBACD,UAAU,CAAC,cAAc,CAAC;wBACtB,QAAQ,KAAI,CAAC,KAAK,EAAE;4BAChB,KAAK,CAAC;gCACF,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;gCACzC,MAAM;4BACV,KAAK,CAAC;gCACF,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;gCACrC,MAAM;4BACV,KAAK,CAAC;gCACF,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gCAC9B,MAAM;4BACV;gCACI,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;gCACrC,MAAM;yBACb;oBACL,CAAC,CAAC,CAAC;iBACN;aACJ;SACJ;IACL,CAAC;IAED,8BAAQ,GAAR;QACI,OAAO,IAAI,CAAC,KAAK,CAAC;IACtB,CAAC;IAxGD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;gDACM;IAGxB;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACS;IAI7B;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;mDACuB;IAGzC;QADC,QAAQ;wDACqB;IAG9B;QADC,QAAQ;8CACS;IAfD,WAAW;QAD/B,OAAO;OACa,WAAW,CA2G/B;IAAD,kBAAC;CA3GD,AA2GC,CA3GwC,EAAE,CAAC,SAAS,GA2GpD;kBA3GoB,WAAW","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport PositionManager from \"./PositionManager\";\n\n@ccclass\nexport default class FlagTrigger extends cc.Component {\n    @property(cc.Node)\n    vehicle: cc.Node = null;\n\n    @property(cc.Prefab)\n    hintPrefab: cc.Prefab = null;\n\n    // use Vec3 is better than Vec2 for 3D compatibility\n    @property(cc.Vec3)\n    hintOffset: cc.Vec3 = cc.v3(0.8, 0.1, 0);\n\n    @property\n    triggerDistance: number = 0.7;\n\n    @property\n    nowIn: number = 0;  // indicate the current stage number we step on\n\n    private hintInstance: cc.Node = null;\n    private hintScript: any = null;\n    private inRange: boolean = false;\n    private isLoadingScene: boolean = false;\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n\n        if (this.hintPrefab) {\n            this.hintInstance = cc.instantiate(this.hintPrefab);\n            this.node.addChild(this.hintInstance);\n\n            this.hintInstance.setPosition(this.hintOffset);\n\n            this.hintInstance.active = false;\n            this.hintInstance.scale = 0;\n\n            this.hintScript = this.hintInstance.getComponent(\"hintAnimation\");\n            this.hintScript.setKeyScale(this.nowIn);\n        }\n    }\n\n    onDestroy() {\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    }\n\n    update(dt: number) {\n        if (!this.vehicle || !this.hintInstance || !this.hintScript) return;\n\n        const posA = this.node.getPosition();\n        const posB = this.vehicle.getPosition();\n        const dist = posA.subtract(posB).mag();\n\n        if (dist < this.triggerDistance) {\n            if (!this.inRange) {\n                this.hintInstance.active = true;\n                this.hintScript.playShow();\n                this.inRange = true;\n            }\n        } else {\n            if (this.inRange) {\n                this.hintScript.playHide();\n                this.inRange = false;\n            }\n        }\n    }\n\n    onKeyDown(event: cc.Event.EventKeyboard) {\n        if (this.inRange && event.keyCode === cc.macro.KEY.e) {\n            cc.log(\"key E pressed\");\n\n            const worldPos = this.vehicle.convertToWorldSpaceAR(cc.Vec3.ZERO);\n            const localPos = this.node.parent.convertToNodeSpaceAR(worldPos);\n            PositionManager.savePosition(localPos.clone());\n\n            if (!this.isLoadingScene) {\n                this.isLoadingScene = true;\n\n                const maskNode = cc.find(\"MainCamera/mask3D\");\n                const maskScript = maskNode?.getComponent(\"maskTransition3D\");\n\n                if (!maskScript) {\n                    console.warn(\"⚠️ maskTransition script not found on mask3D node!\");\n                    return;\n                }\n                else {\n                    maskScript.playTransition(() => {\n                        switch (this.nowIn) {\n                            case 1:\n                                cc.director.loadScene(\"ice-cream-check\");\n                                break;\n                            case 2:\n                                cc.director.loadScene(\"pizza-check\");\n                                break;\n                            case 3:\n                                cc.director.loadScene(\"Menu\");\n                                break;\n                            default:\n                                cc.director.loadScene(\"selectScene\");\n                                break;\n                        }\n                    });\n                }\n            }\n        }\n    }\n\n    getNowIn() {\n        return this.nowIn;\n    }\n}\n"]}