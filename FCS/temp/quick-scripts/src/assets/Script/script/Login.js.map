{"version":3,"sources":["assets\\Script\\script\\Login.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\nimport FirebaseManager from './FirebaseManager';\r\n\r\n@ccclass\r\nexport default class Login extends cc.Component {\r\n    private firebaseManager: FirebaseManager = null;\r\n\r\n    start() {\r\n         //cc.director.loadScene(\"Loading\"); \r\n        // 使用新的方式獲取 FirebaseManager 實例\r\n        this.firebaseManager = FirebaseManager.getFirebaseManager();\r\n        if (!this.firebaseManager.isFirebaseInitialized()) {\r\n            console.error(\"Firebase not initialized!\");\r\n            return;\r\n        }\r\n\r\n        let continueButton = new cc.Component.EventHandler();\r\n        continueButton.target = this.node;\r\n        continueButton.component = \"Login\";\r\n        continueButton.handler = \"onLogin\";\r\n        \r\n        cc.find(\"Canvas/Login/Submit\").getComponent(cc.Button).clickEvents.push(continueButton);\r\n    }\r\n\r\n    onLogin() {\r\n        // 檢查輸入是否為空\r\n        const email = cc.find(\"Canvas/Login/Email\").getComponent(cc.EditBox).string;\r\n        const password = cc.find(\"Canvas/Login/Password\").getComponent(cc.EditBox).string;\r\n\r\n        if (!email || !password) {\r\n            alert(\"請填寫所有欄位\");\r\n            return;\r\n        }\r\n\r\n        // 檢查 email 格式\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (!emailRegex.test(email)) {\r\n            alert(\"請輸入有效的電子郵件地址\");\r\n            return;\r\n        }\r\n\r\n        console.log(\"嘗試登入:\", email);\r\n        \r\n        // 使用 FirebaseManager 進行登入\r\n        this.firebaseManager.getAuth().signInWithEmailAndPassword(email, password)\r\n            .then((userCredential) => {\r\n            console.log(\"登入成功:\", userCredential.user.email);\r\n\r\n            // 存到 PersistentUser\r\n            const persistNode = cc.director.getScene().getChildByName('PersistentUser');\r\n            if (persistNode) {\r\n                const persistScript = persistNode.getComponent('PersistentUser');\r\n                // 取得 nickname 需從 firebase db 抓\r\n                this.firebaseManager.getDatabase().ref('users/' + userCredential.user.uid).once('value')\r\n                    .then((snapshot) => {\r\n                        const nickname = snapshot.val() && snapshot.val().nickname ? snapshot.val().nickname : \"\";\r\n                        persistScript.setUserInfo(userCredential.user.uid, userCredential.user.email, nickname);\r\n                        this.loadMenuPage();\r\n                    })\r\n                    .catch(() => {\r\n                        persistScript.setUserInfo(userCredential.user.uid, userCredential.user.email, \"\");\r\n                        this.loadMenuPage();\r\n                    });\r\n            } else {\r\n                console.warn(\"找不到 PersistentUser persist node！\");\r\n                this.loadMenuPage();\r\n            }\r\n        });\r\n    }\r\n\r\n    loadMenuPage() {\r\n        cc.director.loadScene(\"Loading\");\r\n    }\r\n}\r\n \r\n"]}