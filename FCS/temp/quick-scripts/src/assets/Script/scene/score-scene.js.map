{"version":3,"sources":["assets/Script/scene/score-scene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class ResultScene extends cc.Component {\n    @property(cc.Label)\n    scoreLabel: cc.Label = null;\n\n    @property(cc.Label)\n    sceneLabel: cc.Label = null;  // <== 新增，拖 UI Label 進來\n\n    @property({ type: cc.AudioClip })\n    resultBgm: cc.AudioClip = null;\n\n    @property({ type: cc.Prefab })\n    star1Prefab: cc.Prefab = null;\n\n    @property({ type: cc.Prefab })\n    star2Prefab: cc.Prefab = null;\n\n    @property({ type: cc.Prefab })\n    star3Prefab: cc.Prefab = null;\n\n    @property({ type: cc.Node })\n    starParent: cc.Node = null;\n\n    @property({ type: cc.Node })\n    char1Node: cc.Node = null;\n    @property({ type: [cc.SpriteFrame] })\n    char1Frames: cc.SpriteFrame[] = [];   // 3張圖片\n\n    @property({ type: cc.Node })\n    char2Node: cc.Node = null;\n    @property({ type: [cc.SpriteFrame] })\n    char2Frames: cc.SpriteFrame[] = [];   // 3張圖片\n\n    private char1FrameIdx = 0;\n    private char2FrameIdx = 0;\n    private _sceneChanged = false;\n\n    start() {\n        cc.audioEngine.stopMusic();\n        cc.audioEngine.playMusic(this.resultBgm, true);\n\n        // 取得 persist node\n        const persistNode = cc.director.getScene().getChildByName('ScorePersist');\n        if (!persistNode) {\n            cc.error('找不到 ScorePersist persist node');\n            return;\n        }\n        const persistScript = persistNode.getComponent('ScorePersist');\n        const score = persistScript.score || 0;\n        const fromScene = persistScript.fromScene || '';\n\n        // 顯示分數\n        if (this.scoreLabel) {\n            this.scoreLabel.string = `${score}`;\n        }\n\n        if (persistScript.updateScoreIfHigher) {\n            persistScript.updateScoreIfHigher(score).then((updated: boolean) => {\n                if (updated) {\n                    cc.log(\"🔥 分數已更新到 Firebase！\");\n                } else {\n                    cc.log(\"分數未更新（未超過最高分）\");\n                }\n            }).catch((err: any) => {\n                cc.error(\"🔥 更新 Firebase 分數失敗\", err);\n            });\n        }\n\n        // 顯示來源場景名稱\n        if (this.sceneLabel) {\n            this.sceneLabel.string = fromScene;\n        }\n\n        // 根據分數顯示 n 顆星\n        let starPrefabs = [];\n        if (score >= 500) {\n            starPrefabs = [this.star3Prefab, this.star2Prefab, this.star1Prefab];\n        } else if (score >= 300) {\n            starPrefabs = [this.star2Prefab, this.star1Prefab];\n        } else if (score >= 200) {\n            starPrefabs = [this.star1Prefab];\n        }\n\n        // 實例化並顯示\n        if (this.starParent) {\n            for (let prefab of starPrefabs) {\n                if (prefab) {\n                    const node = cc.instantiate(prefab);\n                    this.starParent.addChild(node);\n                }\n            }\n        }\n\n        this.schedule(this.updateCharFrames, 0.25);\n\n        // 1. 註冊空白鍵監聽\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n\n        // 2. 十秒自動跳場景\n        this.scheduleOnce(() => {\n            this.gotoMenu();\n        }, 10);\n    }\n\n\n    onDestroy() {\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    }\n\n    onKeyDown(event: cc.Event.EventKeyboard) {\n        // 空白鍵是 cc.macro.KEY.space\n        if (event.keyCode === cc.macro.KEY.space) {\n            this.gotoMenu();\n        }\n    }\n\n    gotoMenu() {\n        if (this._sceneChanged) return;\n        this._sceneChanged = true;\n        cc.director.loadScene('selectScene');  // 你的主選單場景名\n    }\n\n    updateCharFrames() {\n        // 角色1\n        if (this.char1Node && this.char1Frames.length > 0) {\n            let sprite1 = this.char1Node.getComponent(cc.Sprite);\n            if (sprite1) {\n                sprite1.spriteFrame = this.char1Frames[this.char1FrameIdx];\n                this.char1FrameIdx = (this.char1FrameIdx + 1) % this.char1Frames.length;\n            }\n        }\n\n        // 角色2\n        if (this.char2Node && this.char2Frames.length > 0) {\n            let sprite2 = this.char2Node.getComponent(cc.Sprite);\n            if (sprite2) {\n                sprite2.spriteFrame = this.char2Frames[this.char2FrameIdx];\n                this.char2FrameIdx = (this.char2FrameIdx + 1) % this.char2Frames.length;\n            }\n        }\n    }\n}\n"]}