{"version":3,"sources":["assets\\Script\\scene\\score-scene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ResultScene extends cc.Component {\r\n    @property(cc.Label)\r\n    scoreLabel: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    sceneLabel: cc.Label = null;  // <== 新增，拖 UI Label 進來\r\n\r\n    @property({ type: cc.AudioClip })\r\n    resultBgm: cc.AudioClip = null;\r\n\r\n    @property({ type: cc.Prefab })\r\n    star1Prefab: cc.Prefab = null;\r\n\r\n    @property({ type: cc.Prefab })\r\n    star2Prefab: cc.Prefab = null;\r\n\r\n    @property({ type: cc.Prefab })\r\n    star3Prefab: cc.Prefab = null;\r\n\r\n    @property({ type: cc.Node })\r\n    starParent: cc.Node = null;\r\n\r\n    @property({ type: cc.Node })\r\n    char1Node: cc.Node = null;\r\n    @property({ type: [cc.SpriteFrame] })\r\n    char1Frames: cc.SpriteFrame[] = [];   // 3張圖片\r\n\r\n    @property({ type: cc.Node })\r\n    char2Node: cc.Node = null;\r\n    @property({ type: [cc.SpriteFrame] })\r\n    char2Frames: cc.SpriteFrame[] = [];   // 3張圖片\r\n\r\n    private char1FrameIdx = 0;\r\n    private char2FrameIdx = 0;\r\n    private _sceneChanged = false;\r\n\r\n    start() {\r\n        cc.audioEngine.stopMusic();\r\n        cc.audioEngine.playMusic(this.resultBgm, true);\r\n\r\n        // 取得 persist node\r\n        const persistNode = cc.director.getScene().getChildByName('ScorePersist');\r\n        if (!persistNode) {\r\n            cc.error('找不到 ScorePersist persist node');\r\n            return;\r\n        }\r\n        const persistScript = persistNode.getComponent('ScorePersist');\r\n        const score = persistScript.score || 0;\r\n        const fromScene = persistScript.fromScene || '';\r\n\r\n        // 顯示分數\r\n        if (this.scoreLabel) {\r\n            this.scoreLabel.string = `${score}`;\r\n        }\r\n\r\n        // 顯示來源場景名稱\r\n        if (this.sceneLabel) {\r\n            this.sceneLabel.string = fromScene;\r\n        }\r\n\r\n        // 根據分數顯示 n 顆星\r\n        let starPrefabs = [];\r\n        if (score >= 150) {\r\n            starPrefabs = [this.star3Prefab, this.star2Prefab, this.star1Prefab];\r\n        } else if (score >= 100) {\r\n            starPrefabs = [this.star2Prefab, this.star1Prefab];\r\n        } else if (score > 60) {\r\n            starPrefabs = [this.star1Prefab];\r\n        }\r\n\r\n        // 實例化並顯示\r\n        if (this.starParent) {\r\n            for (let prefab of starPrefabs) {\r\n                if (prefab) {\r\n                    const node = cc.instantiate(prefab);\r\n                    this.starParent.addChild(node);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.schedule(this.updateCharFrames, 0.25);\r\n\r\n        // 1. 註冊空白鍵監聽\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n\r\n        // 2. 十秒自動跳場景\r\n        this.scheduleOnce(() => {\r\n            this.gotoMenu();\r\n        }, 10);\r\n    }\r\n\r\n\r\n    onDestroy() {\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    }\r\n\r\n    onKeyDown(event: cc.Event.EventKeyboard) {\r\n        // 空白鍵是 cc.macro.KEY.space\r\n        if (event.keyCode === cc.macro.KEY.space) {\r\n            this.gotoMenu();\r\n        }\r\n    }\r\n\r\n    gotoMenu() {\r\n        if (this._sceneChanged) return;\r\n        this._sceneChanged = true;\r\n        cc.director.loadScene('selectScene');  // 你的主選單場景名\r\n    }\r\n\r\n    updateCharFrames() {\r\n        // 角色1\r\n        if (this.char1Node && this.char1Frames.length > 0) {\r\n            let sprite1 = this.char1Node.getComponent(cc.Sprite);\r\n            if (sprite1) {\r\n                sprite1.spriteFrame = this.char1Frames[this.char1FrameIdx];\r\n                this.char1FrameIdx = (this.char1FrameIdx + 1) % this.char1Frames.length;\r\n            }\r\n        }\r\n\r\n        // 角色2\r\n        if (this.char2Node && this.char2Frames.length > 0) {\r\n            let sprite2 = this.char2Node.getComponent(cc.Sprite);\r\n            if (sprite2) {\r\n                sprite2.spriteFrame = this.char2Frames[this.char2FrameIdx];\r\n                this.char2FrameIdx = (this.char2FrameIdx + 1) % this.char2Frames.length;\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}